# ========================================
# 禁用 HTTP/2 - 修复图片加载错误
# ========================================
<IfModule mod_http2.c>
    Protocols http/1.1
</IfModule>

# ========================================
# 启用 Gzip 压缩 - 加快网站速度
# ========================================
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
    AddOutputFilterByType DEFLATE image/svg+xml
</IfModule>

# ========================================
# 浏览器缓存 - 减少重复加载
# ========================================
<IfModule mod_expires.c>
    ExpiresActive On
    
    # 图片缓存1年
    ExpiresByType image/jpg "access plus 1 year"
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/gif "access plus 1 year"
    ExpiresByType image/webp "access plus 1 year"
    ExpiresByType image/svg+xml "access plus 1 year"
    
    # CSS和JS缓存1个月
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
    
    # HTML缓存1小时
    ExpiresByType text/html "access plus 1 hour"
</IfModule>

# ========================================
# 增加上传限制 - 防止大文件超时
# ========================================
<IfModule mod_php7.c>
    php_value upload_max_filesize 32M
    php_value post_max_size 32M
    php_value max_execution_time 300
    php_value max_input_time 300
</IfModule>

# ========================================
# OpenCart 基础配置
# ========================================
Options +FollowSymlinks
Options -Indexes

<FilesMatch "\.(tpl|ini|log)$">
    Order deny,allow
    Deny from all
</FilesMatch>

# SEO URL Support
RewriteEngine On
RewriteBase /
RewriteRule ^sitemap.xml$ index.php?route=extension/feed/google_sitemap [L]
RewriteRule ^googlebase.xml$ index.php?route=extension/feed/google_base [L]
RewriteRule ^system/storage/(.*) index.php?route=error/not_found [L]
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_URI} !.*\.(ico|gif|jpg|jpeg|png|js|css)
RewriteRule ^([^?]*) index.php?_route_=$1 [L,QSA]
