{% set module_id = 'module-featured-' ~ module|default('0') %}

{% if axis == 'horizontal' %}
  <section id="{{ module_id }}" class="module-featured card mb-4">
    <div class="module-featured__header card-header d-flex justify-content-between align-items-center gap-3">
      <h3 class="module-featured__title mb-0">{{ heading_title }}</h3>
      {% if products|length > 1 %}
        <div class="module-featured__controls btn-group" role="group" aria-label="{{ heading_title }}">
          <button type="button" class="module-featured__control btn btn-outline-primary btn-sm" data-direction="prev" aria-label="Previous featured products">
            &#8249;
          </button>
          <button type="button" class="module-featured__control btn btn-outline-primary btn-sm" data-direction="next" aria-label="Next featured products">
            &#8250;
          </button>
        </div>
      {% endif %}
    </div>
    <div class="module-featured__body card-body">
      <div class="module-featured__viewport" tabindex="0">
        <div class="module-featured__track">
          {% for product in products %}
            <div class="module-featured__item">{{ product }}</div>
          {% endfor %}
        </div>
      </div>
    </div>
  </section>
  <script>
    (() => {
      const root = document.getElementById('{{ module_id }}');
      if (!root) {
        return;
      }

      const viewport = root.querySelector('.module-featured__viewport');
      const track = root.querySelector('.module-featured__track');
      if (!viewport || !track) {
        return;
      }

      const controls = root.querySelectorAll('.module-featured__control');

      const updateControls = () => {
        const maxScroll = track.scrollWidth - viewport.clientWidth;
        controls.forEach((button) => {
          if (button.dataset.direction === 'prev') {
            button.disabled = track.scrollLeft <= 0;
          }

          if (button.dataset.direction === 'next') {
            button.disabled = track.scrollLeft >= maxScroll - 1;
          }
        });
      };

      controls.forEach((button) => {
        button.addEventListener('click', () => {
          const direction = button.dataset.direction === 'prev' ? -1 : 1;
          const scrollAmount = viewport.clientWidth * 0.9;
          track.scrollBy({ left: scrollAmount * direction, behavior: 'smooth' });
        });
      });

      track.addEventListener('scroll', updateControls, { passive: true });
      window.addEventListener('resize', updateControls, { passive: true });

      updateControls();
    })();
  </script>
{% else %}
  <h3 class="module-featured__title module-featured__title--stacked">{{ heading_title }}</h3>
  <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-xl-4">
    {% for product in products %}
      <div class="col mb-3">{{ product }}</div>
    {% endfor %}
  </div>
{% endif %}
